#!/bin/bash
# Script: summaryData-0x03
# Purpose: Summarize Pokémon data into CSV and calculate averages

DATA_DIR="pokemon_data"
REPORT_FILE="pokemon_report.csv"

# 1️⃣ Start the CSV file with a header
echo "Name,Height (m),Weight (kg)" > "$REPORT_FILE"

# 2️⃣ Loop through all JSON files in the folder
for file in "$DATA_DIR"/*.json
do
    # 3️⃣ Extract values using jq
    name=$(jq -r '.name' "$file")
    height=$(jq -r '.height' "$file")
    weight=$(jq -r '.weight' "$file")

    # 4️⃣ Convert decimeters → meters and hectograms → kilograms
    height_m=$(awk "BEGIN {printf \"%.1f\", $height/10}")
    weight_kg=$(awk "BEGIN {printf \"%.1f\", $weight/10}")

    # 5️⃣ Capitalize the name
    name_cap=$(echo "$name" | sed 's/.*/\u&/')

    # 6️⃣ Append formatted line to the CSV
    echo "${name_cap},${height_m},${weight_kg}" >> "$REPORT_FILE"
done

# 7️⃣ Print report path
echo "CSV Report generated at: $REPORT_FILE"

# 8️⃣ Calculate averages using awk
awk -F',' '
NR>1 {h+=$2; w+=$3; c++}
END {
    printf "\nAverage Height: %.2f m\nAverage Weight: %.2f kg\n", h/c, w/c
}' "$REPORT_FILE"

